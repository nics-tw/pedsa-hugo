[{"id":0,"href":"/pedsa-hugo/zh/docs/chapter1/","title":"PEDSA 安裝教學","section":"Docs","content":" 目的 # 本文期望能夠幫助使用者、資訊人員或是廠商在觀看本手冊後，能夠了解並且能自行安裝 PEDSA 系統。\nPEDSA主要提供 K匿名、資料生成及差分隱私三種服務。此外，為了方便多個導入機關共同處理資料，也提供資料安全鏈結系統，讓不同機關的使用者安全的上傳檔案及鏈結資料。PEDSA 區分為服務端與使用端，服務端包含 K 匿名、資料生成、差分隱私以及安全鏈結，使用端則提供加密機敏欄位、安全上傳檔案兩個功能。\n無論服務端與使用端，都建置於 docker 微服務架構上。為了在Linux Ubuntu 平台上提供了一個快速且有效的部署方案，並考量部分導入機關需在隔離的環境中進行軟體安裝，故提供shell script 和 tar 檔案，允許在沒有網際網路連接的情況下，經由 tar 檔案取得安裝所需的所有檔案，並透過 shell script 方式安裝系統，確保在網際網路連線受限的環境中能夠順利地安裝 docker 執行環境、安裝必須的 docker 映像檔(image)及部署PEDSA 系統應用軟體。\n部署好的服務端如圖 1，包括安全鏈結、K 匿名、差分隱私及資料生成等服務，圖 1 的 hadoopnet_overlay 及hadoopnet_pet_overlay 都是 docker 網路。由於安全資料鏈結服務會與外部的使用端連線，為了安全考量，安全資料鏈結服務單獨放在 hadoopnet_pet_overlay 與其他服務隔離。\nTODO:\n圖 2 則為使用端，使用端功能有二，首先是針對使用者選擇的欄位，對 csv 文件的個別欄位進行 AES 加密或 HMAC 雑湊運算，接著就以 scp 協定上傳運算後的 csv 文件。服務端接收到 csv 文件後，安全資料鏈結服務會鏈結所有文件，再將處理好的資料傳給其他服務進行處理。\nTODO:\n部署流程圖範圍 # 由上述可知，本手冊的重點在於讓使用者順利了解如何安裝部署，同時也能快速部署上手。由於 PEDSA 使用獨立的 docker 容器來運行服務，部署前需安裝 docker、docker 映像檔及系統應用程式，最後才是啟動 PEDSA 的服務端及使用端。安裝及啟動流程概述如下:\n安裝 docker:安裝 docker 運行環境，建立 PEDSA 需要的 docker 網路 安裝 docker 映像檔:載入 PEDSA 需要的映像檔 安裝 PEDSA 系統應用程式:解壓縮 PEDSA 應用程式到使用者 指定位置 以上流程會透過 shell script 的提示，引導使用者安裝PEDSA 系統。 "},{"id":1,"href":"/pedsa-hugo/zh/docs/chapter1/install/","title":"安裝流程","section":"PEDSA 安裝教學","content":"本系統手冊將描述如何在 Linux Ubuntu 系統上利用 docker 部署微服務架構，進而組成 PEDSA 系統。安裝的流程如圖 3:\nTODO:\n系統環境資源建議：此步驟會依據基準資料列出所需的主機的基本需求，導入機關再依據需求的資料量、分析案例規模彈性調整主機的硬體資源。\n執行環境安裝:在主機上安裝 docker 執行環境，建置 docker 網路及安裝 PEDSA 應用程式。\nPEDSA 啟動:會介紹如何啟動服務端及使用端系統，詳細的內容於\u0026quot;前置作業及軟硬體介紹\u0026quot;章節解說。\n安裝前置作業及軟硬體介紹 # 系統環境資源建議 # 導入機關選擇硬體規格時，可參考表 1 的基準資料及表 2的硬體資訊:\n表1: 基準資料特徵\n資料筆數 預估大小 欄位 直接識別 間接識別 敏感欄位 1,000,000 1G 15 2 6 4 表2: 建議之硬體資源\n最低需求 CPU(core) RAM(GB) Storage(GB) K匿名 8 16 1024 合成資料 8 32 512 差分隱私 4 16 256 PEDSA 建議於 Linux Ubuntu 22.04 LTS 版本進行安裝。表 1 及表 2 的推論過程放在附錄的\u0026quot;環境評估資源\u0026quot;段落，方便導入機關做進一步探討。\n執行環境安裝 # 部署步驟優化(分服務端與使用端) # 考量部分導入機關需在隔離的環境中進行軟體安裝，提供shell script 和 tar 檔案，允許在沒有網際網路連接的情況下，經由 tar 檔案取得安裝所需的所有檔案，並透過 shell script 執行安裝指令，以確保在受限的環境中也能夠順利地部署系統。\n解壓縮 PEDSA 系統程式及相關工具軟體 # deploy_PEDSA_1012.tar.gz 包含 PEDSA 系統所需的程式及第三方工具軟體，首先執行\nsource tar -xzvf deploy_PEDSA_1012.tar.gz 解壓縮後會產生目錄 deploy_PEDSA，目錄的內容如表 3:\n表3: 部署檔案說明\n檔案名稱 說明 deploy_pedsa.sh 部署 PEDSA 的安裝程式，即是解壓縮下面的*.tar.gz，並修正目錄權限。 pedsa_s.tar.gz PEDSA 服務端的程式及設定檔等，解開的目錄名稱為 pedsa_s pedsa_c.tar.gz PEDSA 使用端的程式及設定檔，解開的目錄名稱為 pets_dir_v1 pedsa_images.tar.gz PEDSA 系統所需映像檔，解開的目錄名稱為 pedsa_images dockerd-src-v26-withTLSCert1012.tar.gz docker 離線安裝程式 ，解開的目錄名稱為 dockerd-src PEDSA 服務端系統之安裝四步驟 # Step1 # cd deploy_PEDSA source ./deploy_pedsa.sh 會提示輸入安裝路徑 ($deploy_dir) ，執行完畢會在$deploy_dir 會產出 pedsa_s, pets_dir_v1 ,dockerd-src 及 pedsa_images 等目錄，如上表所示，假設$deploy_dir 為 /home/itri-pedsa/ deploy_PEDSA，則有圖 4 的檔案結構:\n![圖4: deploy_PEDSA檔案結構]\nStep2 # cd dockerd-src source ./create_docker_env.sh 安裝過程中需輸入以下參數：\n主機 IP(例如 34.81.71.21): docker 宿主主機的 IP 地址 輸入 PEDSA 安裝目錄: 此安裝目錄就是 pedsa_s 的所在位置，以上圖為例 ， pedsa_s 的位置為 /home/itri-pedsa/deploy_PEDSA，則輸入 PEDSA 安裝目錄就為 /home/itri-pedsa/deploy_PEDSA Host User Password: 輸入主機使用者密碼，若是沒有使用者密碼則不需輸入 Enter pass phrase for ./ca-key.pem: 輸入 iclw200@ 指令執行完畢會建立 docker 環境，docker network，及 mount 下載目錄。安裝過程有幾個可能發生狀況，\n若是主機是第一次安裝 docker 環境，並在執行 docker 的基本指令，如 docker ps，出現權限不足的錯誤時，需關閉目前的 terminal，再開啟新的 terminal 再進行後續步驟。 若是看到下載目錄不存在的提示，則需執行 mount 下載目錄的程式，這會在安裝服務端的步驟(Step4)詳述。 Step3 # cd pedsa_images source ./load_docker_imgs.sh 安裝系統需要的映像檔\nStep4 # cd pedsa_s source ./petsStartUp.sh 安裝服務端過程中需輸入以下參數：\n輸入 PEDSA 安裝目錄: 此安裝目錄就是 pedsa_s 的所在位置，以上圖為例 ， pedsa_s 的位置為 /home/itri-pedsa/deploy_PEDSA，則輸入 PEDSA 安裝目錄就為 /home/itri-pedsa/deploy_PEDSA 主機 IP(例如 34.81.71.21): docker 宿主主機的 IP 地址 Host User Password: 輸入主機使用者密碼，若是沒有使用者密碼則不需輸入 安裝後須注意下列狀況:\n若是在 Step2 看到下載目錄不存在的提示或是無法下載檔案，則執行source ./mountDownloadFilePATH.sh，執行過程需輸入以下參數與後續步驟： 輸入 PEDSA 安裝目錄: 輸入服務端 pedsa_s 的安裝位置 Host User Password: 輸入主機使用者密碼，若是沒有使用者密碼則不需輸入 執行完畢需重新執行 source ./petsStartUp.sh。 若發現使用端無法上傳資料給服務端，則執行source ./gen_ssh_key.sh，執行過程有數個提示如下： 輸入 PEDSA 使用端的安裝目錄: 當 pets_dir_v1 的路徑為 /home/itripedsa/deploy_PEDSA/pets_dir_v1 則安裝目錄為 /home/itri-pedsa/deploy_PEDSA 輸入 PEDSA 使用端的使用者名稱: 安裝使用端主機的使用者名稱 輸入 PEDSA 使用端的使用者密碼: 安裝使用端主機的使用者密碼 輸入 PEDSA 使用端的 IP: 安裝使用端主機的 IP 地址 PEDSA 使用端系統之安裝四步驟 # Step1~3 與服務端相同\nStep4 # cd pets_dir_v1 source ./initialSystem.sh 安裝使用端，執行過程有數個提示如下:\n輸入 PEDSA 使用端安裝目錄: 當 pets_dir_v1 的路徑為 /home/itripedsa/deploy_PEDSA/pets_dir_v1 則安裝目錄為 /home/itri-pedsa/deploy_PEDSA 輸入 PEDSA 服務端安裝目錄: 當 petsa_s 的路徑為 /home/itripedsa/deploy_PEDSA/petsa_s 則安裝目錄取 /home/itri-pedsa/deploy_PEDSA 輸入 PEDSA 服務端提供的使用者名稱: 安裝服務端主機的使用者名稱 主機 IP: 輸入安裝服務端主機的 IP 地址 PEDSA 系統服務所使用的軟體 # PEDSA使用軟體程式 版本 React 11.10 Next JS 12.1 .NET Core C# 3.1 Python 3.8 Hadoop 2.7.4 Spark 2.3.1 MariaDB 10.3 "},{"id":2,"href":"/pedsa-hugo/zh/docs/chapter1/network/","title":"網路設定","section":"PEDSA 安裝教學","content":" Docker 介紹與 Docker 環境建置 # 如前所述(執行環境安裝的 step2)，進入 dockerd-src 目錄，執行source create_docker_env.sh, 就可以安裝 docker 並建立 docker network，安裝的過程中，需輸入主機使用者密碼，此使用者須有 sudo 權限，才可以正確安裝。正確安裝後，可以顯示 docker 版本資訊，如圖 5 所示\n若 create_docker_env.sh 正常完成，停留在圖 6 的畫面，按下Ctrl+c 即可跳出。\n![圖6: 正確的docker狀態]\nPEDSA 啟動注意事項及各服務說明 # 啟動系統前，需先確認表 6 所列的通訊埠(port)是否開通:\n表5: 服務端需要開通的通訊埠\n通訊埠號 說明 22 服務端與使用端登入連線用 11016 服務端 API 通訊埠 443 服務端 SSL 通訊埠 11100 資料庫 6922 服務端 Hadoop 5922 K 匿名與使用端 Hadoop 5088 合成 API 5915 K匿名與使用端API 5090 差分API 如前所述(執行環境安裝的 step4)，經由 step4 步驟啟動後，會產生 PETWEB 、 PETservice 、 PET_join 、 PETSHadoop 、PETSWebservice、pets_dp 及 pets_syn 等 7 個 docker 服務叢集，可執行docker stack ls 得到相關資訊。服務端系統的服務如下表內容:\n表6: PEDSA 服務端系統說明\nPEDSA 系統服務 說明 pets_web、pets_service PEDSA 系統的管理介面，管控 K 匿名、資料生成及差分隱私三個隱私強化技術 PET_join_Hadoop 負責整合各單位資料的安全鏈結 PETSHadoop、PETSWebservice K 匿名服務 pets_syn 資料合成服務 pets_dp 差分隱私服務 服務端使用兩個 docker 網路，分別為:\nhadoopnet_overlay: 使用的服務有 pets_syn、pets_dp、pets_web、pets_k 與 pets_service。 hadoopnet_pet_overlay: 由 pets_hadoop 所使用。 正確的 PEDSA 啟動，可以由執行:\ndocker service logs pets_service_fastapi 正確的啟動畫面如下圖: ![圖8: 正確的 pets_service 啟動畫面]\n當服務端正確的啟動，就可以在瀏覽器連接:\nhttps://IP_addr https://IP_addr/kweb https://IP_addr/synweb https://IP_addr/dpweb 等4個網頁, 若是能正確開啟網頁即是正確啟動。\nPEDSA服務端目錄結構: docker 服務檢視: docker service ls ![圖10: 組成PEDSA系統之容器]\nPEDSA安裝流程介紹 - 使用端 # 為了正確啟動使用端，開放的通訊埠如下:\n表7: 服務端需要開通的通訊埠\n通訊埠號 說明 22 服務端與使用端登入連線用 443 使用端 SSL通訊埠 5915 加密欄位及安全資料鏈結用通訊埠 11050 使用端用通訊埠 使用端使用 hadoopnet_web_overlay 網路連結服務容器，由於與服務端使用不同 docker 網路，因此同一主機可以同時啟動服務端和使用端。\n當使用端正確的啟動，就可以在瀏覽器連接:\nhttps://IP_addr:11050 系統重設與重新安裝(包含移機，重新安裝) # 在移機或重新安裝系統時，需要先停止現有的 docker 服務，以避免程式因程式仍在執行而無法複製。可執行\nsudo systemctl stop docker 停止 docker 服務。如果 docker 服務被 docker.socket 喚醒，則可能需要額外執行 systemctl stop docker.socket 以確保服務完全停止。其他就如同安裝步驟。\n"},{"id":3,"href":"/pedsa-hugo/zh/docs/chapter1/faq/","title":"FAQ","section":"PEDSA 安裝教學","content":" 當系統安裝好，如何確認系統是否正常啟動? # 通常可以執行 `docker ps -a```，觀察是否有出現錯誤訊息時出現的錯誤，多為 docker 設定出錯，例如容器目錄與外部主機原有的對應關係無法滿足，或是 docker 映像檔版本不合等。\n當 docker 容器都正常啟動，但 PEDSA 行 docker logs fastapi，fastapi 是容器名稱，此容器負責前後端的控制流程，可以觀察到哪一個服務出錯，其他的容器名稱可以由 docker ps -a 指令查詢，容器名稱出現在最後一個欄位，如下圖的 NAMES 欄位。\n以瀏覽器開啟 PEDSA 網頁沒有反映需如何處理? # 遇到此情況，執行\ndocker service logs pets_syn_nginx 觀察是否出錯，nginx 的功能是代轉容器流量，因此有任 何一個容器出錯，均會讓 nginx 無法啟動。除此，也可以 向機房管理員查詢防火牆是否開放表 5 所列的通訊埠。\n當 fastapi 無法連上 MariaDB，要如何處理? # 執行docker ps -a查詢 MariaDB的容器名稱，再執行docker logs $MariaDB_container_name 觀察資料庫是否正常運作，正常會出現\u0026quot; mysqld: ready for connections. \u0026ldquo;訊息。\n若有出錯，可執行ls -al ~/PETS/pets_hadoop/pets_v1/sourceCode/hadoop/MariaDBdata/ ,觀察的擁有者是否為 999:999，若否，則執行sudo chown -R 999:999 ~/PETS/pets_hadoop/pets_v1/sourceCode/hadoop/MariaDBdata/\n"}]